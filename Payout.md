# Протокол информационного обмена Партнера и Системы выплат Mercuryo

**Table of contents**

1. [Используемые запросы](/Payouts.md#1-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D1%8B%D0%B5-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%8B)
2. [Описание параметров](/Payouts.md#2-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2)
3. [Запрос на выплату](/Payouts.md#3-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D0%BD%D0%B0-%D0%B2%D1%8B%D0%BF%D0%BB%D0%B0%D1%82%D1%83)
4. [Оповещение о выплате](/Payouts.md#4-%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE-%D0%B2%D1%8B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5)
5. [Запрос статуса выплаты](/Payouts.md#5-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D1%81%D1%82%D0%B0%D1%82%D1%83%D1%81%D0%B0-%D0%B2%D1%8B%D0%BF%D0%BB%D0%B0%D1%82%D1%8B)
6. [Запрос баланса партнера](/Payouts.md#6-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D0%B1%D0%B0%D0%BB%D0%B0%D0%BD%D1%81%D0%B0-%D0%BF%D0%B0%D1%80%D1%82%D0%BD%D0%B5%D1%80%D0%B0)
7. [Запрос выписки по зачислениям за период](/Payouts.md#7-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D0%B2%D1%8B%D0%BF%D0%B8%D1%81%D0%BA%D0%B8-%D0%BF%D0%BE-%D0%B7%D0%B0%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F%D0%BC-%D0%B7%D0%B0-%D0%BF%D0%B5%D1%80%D0%B8%D0%BE%D0%B4)
8. [Запрос реестра операций за период](/Payouts.md#9-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%BD%D0%B0%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B9-%D0%B2%D1%8B%D0%BF%D0%BB%D0%B0%D1%82)
9. [Список направлений выплат](/Payouts.md#1-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D1%8B%D0%B5-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%8B)
10. [Тестовые карты](/Payouts.md#10-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B5-%D0%BA%D0%B0%D1%80%D1%82%D1%8B)

[FAQ](/Payouts.md#faq)


### 1. Используемые запросы.

Для передачи информации между Системой выплат и Партнером используются следующие http-запросы:

| Направление запроса       | Форма                         | Описание                                                                                            | URL                                             |
|---------------------------|-------------------------------|-----------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Партнер –> Система выплат | Запрос на выплату, POST       | Генерируется Партнером в Систему выплат для инициации выплаты по указанным реквизитам.              | `URL_SYSTEM/partner/SERVICE_ID/payout`            |
| Система выплат –> Партнер | Оповещение о выплате, POST    | Генерируется Системой выплаты для оповещения о выплате Партнеру.                                    | Предоставляется партнером                       |
| Партнер –> Система выплат | Запрос статуса выплаты, POST  | Генерируется Партнером в Систему выплат для получения статуса выплаты.                              | `URL_SYSTEM/partner/SERVICE_ID/check`           |
| Партнер –> Система выплат | Запрос баланса партнера, POST | Генерируется Партнером в Систему выплат для получения баланса доступного к расходованию на выплаты. | `URL_SYSTEM/partner/SERVICE_ID/balance`           |
| Партнер –> Система выплат | Запрос выписки, POST          | Генерируется Партнером в Систему выплат для получения выписки операций по балансу.                  | `URL_SYSTEM/partner/SERVICE_ID/balance_statement` |
| Партнер –> Система выплат | Запрос реестра операций, GET  | Генерируется Партнером в Систему выплат для получения реестра операций за период.                   | В описании запроса ниже.                        |

> Sandbox URL_SYSTEM : https://int.win-pay.ru

> Pruduction URL_SYSTEM : https://win-pay24.ru

### 2. Описание параметров.

| № | Название параметра                      | Параметр    | Описание                                                                                                                                                                                                                                                                                                        |
|:---:|-----------------------------------------|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 | Идентификатор аккаунта в системе выплат | SERVICE_ID  | Уникальный идентификатор аккаунта партнера в системе выплат. Целое положительное число. На каждую валюту выплат создается отдельный аккаунт.                                                                                                                                                                    |
| 1 | Идентификатор выплаты                   | ID          | Идентификатор заявки на выплату (перевод) в системе партнера. Уникальны для партнера.                                                                                                                                                                                                                           |
| 2 | Дата-время                              | DT          | Дата и время составления запроса. (Формат: YYYY-MM-DD HH:MM:SS — напр. '2014-01-31 17:29:34')                                                                                                                                                                                                                   |
| 3 | Сумма выплаты                           | AMOUNT      | Сумма к зачислению получателю перевода. Сумма должна быть больше нуля, дробная часть отделяется точкой.                                                                                                                                                                                                         |
| 4 | Телефон клиента                         | PHONE       | Телефон клиента получателя перевода.                                                                                                                                                                                                                                                                            |
| 5 | Идентификатор клиента                   | CLIENT      | Идентификатор клиента в системе получателя. Номер телефона, номер банковской карты, номер лицевого счета или иное.                                                                                                                                                                                              |
| 6 | Идентификатор получателя                | DESTINATION | Направление/получатель перевода. Текстовое поле, содержит код получателя – оператора сотовой связи, автоматическое определение оператора сотовой связи, направление банккарт, иное. Справочник в конце документа.                                                                                               |
| 7 | Контрольная подпись                     | HASH        | Контрольная подпись. Используется для проверки целостности полученной информации и однозначной идентификации отправителя. Алгоритм формирования MD5-хеш (ID+DT+AMOUNT+PHONE+CLIENT+DESTINATION+SecretKey), где «+» - знак конкатенации, SecretKey – секретный ключ. Остальные параметры описаны выше в таблице. |

*Дополнительные параметры (обязательные для некоторых направлений).*

| № | Название параметра    | Параметр            | Описание                                                                                                                                                                  |
|:----:|-----------------------|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8  | Валюта выплаты        | CURRENCY            | Варианты – RUB, EUR, USD, KZT, UAH, GBP. Если не передается, то считается, что выплата в рублях. При несовпадении валюты аккаунта и валюты выплаты – будет передан отказ. |
| 9  | ФИО отправителя       | PAYER_FIO           | Фамилия Имя Отчество отправителя перевода.                                                                                                                                |
| 10 | Фамилия               | PAYER_LAST_NAME     | Фамилия отправителя перевода.                                                                                                                                             |
| 11 | Имя                   | PAYER_FIRST_NAME    | Имя отправителя перевода.                                                                                                                                                 |
| 12 | Отчество              | PAYER_MIDDLE_NAME   | Отчество отправителя перевода.                                                                                                                                            |
| 13 | Тип документа         | PAYER_DOC_TYPE      | Тип документа, удостоверяющего личность отправителя перевода. Значения: 1. Паспорт гражданина РФ - 21; 2. Общегражданский заграничный паспорт - 22; 3. Паспорт иностранного гражданина - 10 |
| 14 | Серия документа       | PAYER_DOC_SER       | Серия документа, удостоверяющего личность отправителя перевода.                                                                                                           |
| 15 | Номер документа       | PAYER_DOC_NUM       | Номер документа, удостоверяющего личность отправителя перевода.                                                                                                           |
| 16 | Кем выдан документ    | PAYER_DOC_ISSUER    | Кем выдан документ, удостоверяющий личность отправителя перевода.                                                                                                         |
| 17 | Дата выдачи документа | PAYER_DOC_DATE      | Дата выдачи документа, удостоверяющего личность отправителя перевода.                                                                                                     |
| 18 | Дата рождения         | PAYER_BIRTH_DATE    | Дата рождения отправителя перевода.                                                                                                                                       |
| 19 | Место рождения        | PAYER_BIRTH_PLACE   | Место рождения отправителя перевода.                                                                                                                                      |
| 20 | Адрес                 | PAYER_ADDRESS       | Адрес отправителя перевода, по месту регистрации.                                                                                                                         |
| 21 | ФИО получателя        | RECEIVER_FIO        | Фамилия Имя Отчество получателя перевода.                                                                                                                                 |
| 22 | Страна                | RECEIVER_COUNTRY    | Страна получателя перевода. Формат ISO 3166-1-Alpha 2.                                                                                                                    |
| 23 | Город                 | RECEIVER_CITY       | Город получателя перевода. Значение текстовое либо цифровой код.                                                                                                          |
| 24 | Дата рождения         | RECEIVER_BIRTH_DATE | Дата рождения получателя перевода. (Формат: YYYY-MM-DD, пример '2014-01-31')                                                                                              |
| 25 | БИК                   | RECEIVER_BIC        | БИК банка получателя.                                                                                                                                                     |
| 26 | Владелец карты        | CARD_HOLDER         | Владелец карты                                                                                                                                                            |
| 27 | Валюта карты          | CARD_CURRENCY       | Валюта карты (Возможные значения: RUB, EUR, USD, KZT, UAH, GBP)                                                                                                           |
| 28 | Срок действия      | CARD_EXPIRE      | Срок действия карты. Формат MM/YY. |
| 29 | Назначение платежа | DETAILSOFPAYMENT | Назначение платежа.                |


> Данные необходимо кодировать application/x-www-form-urlencoded.

### 3. Запрос на выплату.

| Название параметра             | Параметр                                               |
|--------------------------------|--------------------------------------------------------|
| Идентификатор выплаты партнера | ID                                                     |
| Дата-время                     | DT                                                     |
| Сумма выплаты                  | AMOUNT                                                 |
| Телефон клиента                | PHONE                                                  |
| Идентификатор клиента          | CLIENT                                                 |
| Идентификатор получателя       | DESTINATION                                            |
| Контрольная подпись            | HASH (ID+DT+AMOUNT+PHONE+CLIENT+DESTINATION+SecretKey) |

*Дополнительные параметры (обязательные для некоторых направлений, уточнять при подключении).*

| Название параметра             | Параметр                                               |
|--------------------------------|--------------------------------------------------------|
| Валюта выплаты                 | CURRENCY                                               |
| ФИО отправителя                | PAYER_FIO                                              |
| Фамилия                        | PAYER_LAST_NAME                                        |
| Имя                            | PAYER_FIRST_NAME                                       |
| Отчество                       | PAYER_MIDDLE_NAME                                      |
| Тип документа                  | PAYER_DOC_TYPE                                         |
| Серия документа                | PAYER_DOC_SER                                          |
| Номер документа                | PAYER_DOC_NUM                                          |
| Кем выдан документ             | PAYER_DOC_ISSUER                                       |
| Дата выдачи документа          | PAYER_DOC_DATE                                         |
| Дата рождения                  | PAYER_BIRTH_DATE                                       |
| Место рождения                 | PAYER_BIRTH_PLACE                                      |
| Адрес                          | PAYER_ADDRESS                                          |
| ФИО получателя                 | RECEIVER_FIO                                           |
| Страна                         | RECEIVER_COUNTRY                                       |
| Город                          | RECEIVER_CITY                                          |
| Дата рождения                  | RECEIVER_BIRTH_DATE                                    |
| БИК                            | RECEIVER_BIC                                           |
| Владелец карты                 | CARD_HOLDER                                            |
| Валюта карты                   | CARD_CURRENCY                                          |
| Срок действия                  | CARD_EXPIRE                                            |
| Назначение платежа             | DETAILSOFPAYMENT                                       |


Ответ (response) в формате XML, кодировка UTF-8 (Content-type: application/xml):

    <?xml version="1.0" encoding="UTF-8"?>
    <response>
        <id>ID</id>
        <result>RESULT</result>
    </response>
        
| Параметр | Описание                                     | Обязательный параметр                                                                                                                                                                                                                                                                |
|----------|----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID       | Идентификатор выплаты партнера               | Обязателен для result=OK                                                                                                                                                                                                                                                             |
| RESULT   | Текстовое описание текущего статуса выплаты. | Да. (`OK` или `ERROR`: <текстовое описание ошибки> . `OK` — запрос получен успешно. `ERROR` — произошла ошибка и взаимодействие требуется прекратить. Если выплата с таким ID уже существует, то поле содержит текстовое описание аналогично запросу статуса (`PAID`, `NOT_PAID`, `PROCESSING`)) |

### 4. Оповещение о выплате.

| Название параметра             | Параметр                                                     |
|--------------------------------|--------------------------------------------------------------|
| Идентификатор выплаты партнера | ID                                                           |
| Дата-время                     | DT                                                           |
| Сумма выплаты                  | AMOUNT                                                       |
| Результат выплаты              | RESULT (1 — выплата произведена, 0 — выплата не произведена) |
| Ошибки выплаты                 | ERROR (При RESULT = 0 — содержит описание причины невыплаты) |
| Идентификатор получателя       | DESTINATION                                                  |
| Контрольная подпись            | HASH (ID+DT+AMOUNT+RESULT+DESTINATION+SecretKey)             |

Партнер должен ответить на этот запрос текстом: `OK` или `ERROR`. 
> `OK` — статус получен успешно. 

> `ERROR` — произошла ошибка и взаимодействие требуется прекратить. 

При получении любого другого ответа (другой текст, или http статус не равный 200) Система выплат повторяет запросы до успешной передачи статуса.

Повторные оповещения направляются через интервалы (секунды): 10,30,60,60,60,60,60,300,300,300,3600 и через 48 часов прекращаем.


### 5. Запрос статуса выплаты.

| Название параметра             | Параметр                                   |
|--------------------------------|--------------------------------------------|
| Идентификатор выплаты партнера | ID                                         |
| Дата-время                     | DT                                         |
| Сумма выплаты                  | AMOUNT                                     |
| Идентификатор получателя       | DESTINATION                                |
| Контрольная подпись            | HASH ( ID+DT+AMOUNT+DESTINATION+SecretKey) |


Ответ (response) в формате XML, кодировка UTF-8 (Content-type: application/xml):

    <?xml version="1.0" encoding="UTF-8"?>
    <response>
        <id>ID</id>
        <result>RESULT</result>
        <error>ERROR</error>
    </response>

| Параметр | Описание                                     | Обязательный параметр                                                                                                              |
|----------|----------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| ID       | Идентификатор выплаты                        | Обязателен                                                                                                                         |
| RESULT   | Текстовое описание текущего статуса выплаты. | Да. Принимает значения:  `PAID` — оплачено, `NOT_PAID` — выплата не произведена,  `NOT FOUND` — не найдена, `PROCESSING` — обрабатывается. |
| ERROR*   | Текстовое описание ошибки выплаты            | Обязателен для RESULT = PAID / NOT_PAID                                                                                            |


Актуальный статус транзакции запрашивать не ранее чем через 1 минуту от момента инициации выплаты. Предоставляется по запросу.


### 6. Запрос баланса партнера.

| Название параметра  | Параметр            |
|---------------------|---------------------|
| Дата-время          | DT                  |
| Контрольная подпись | HASH (DT+SecretKey) |

Ответ (response) в формате XML, кодировка UTF-8 (Content-type: application/xml):

    <?xml version="1.0" encoding="UTF-8"?>
    <response>
        <balance>BALANCE</balance>
    </response>

| Параметр | Описание                              |
|----------|---------------------------------------|
| BALANCE  | Размер доступного к выплатам баланса. |


### 7. Запрос выписки по зачислениям за период.

| Название параметра        | Параметр                         |
|---------------------------|----------------------------------|
| Дата-время начала периода | DT_START (dd.MM.yyyy HH:mm)      |
| Дата-время конца периода  | DT_END    (dd.MM.yyyy HH:mm)     |
| Контрольная подпись       | HASH (DT_START+DT_END+SecretKey) |

Ответ (response) в формате XML, кодировка UTF-8 (Content-type: application/xml):

    <?xml version="1.0" encoding="UTF-8"?>
    <response>
      <statement id="ID" dt="DT" type="TYPE">
            <sum>SUM</sum>
            <comment>COMMENT</comment>
      </statement>
       ......

     <statement ....>
       ......
     </statement>
    </response>

| Параметр | Описание                                           |
|----------|----------------------------------------------------|
| ID       | Внутренний ID операции с балансом                  |
| DT       | Дата-время операции с балансом  (dd.MM.yyyy HH:mm) |
| TYPE     | Тип операции: IN — зачисление, OUT - списание      |
| SUM      | Сумма операции зачисления/списания                 |
| COMMENT  | Комментарий                                        |


### 8. Запрос реестра операций за период.

| Название параметра                      | Параметр                         |
|-----------------------------------------|----------------------------------|
| Тип реестра                             | TYPE (xml, json, csv)            |
| Идентификатор партнера в системе выплат | SERVICE_ID (число)               |
| Дата-время начала периода               | DT_START (dd.MM.yyyy HH:mm)      |
| Дата-время конца периода                | DT_END (dd.MM.yyyy HH:mm)        |
| Контрольная подпись                     | HASH (DT_START+DT_END+SecretKey) |

Запрос направляется на `URL_SYSTEM/reestr/TYPE?SERVICE_ID=SERVICE_ID&DT_START=DT_START&DT_END=DT_END&HASH=HASH`

В ответе на запрос будет передан реестр за указанный период в запрошенном формате.

Выборка осуществляется по дате-времени создания операции в Системе. 

Берутся все операции, удовлетворяющие условию DT_START<= Дата-время создания < DT_END.


### 9. Список направлений выплат.

| Направление                               | DESTINATION | Обязательные поля  | Валюта выплат |
|-------------------------------------------|-------------|--------------------|---------------|
| Пополнение Visa\Mastercard РФ             | 1           | 1-7, 21            | RUB           |
| Пополнение Visa\Mastercard (CRD,P2P)      | 3           | 1-8, 21-24, 26, 28 | EUR, USD, GBP |
| Пополнение карта МИР                      | 4           | 1-7, 21            | RUB           |
| Пополнение Visa\Mastercard Мир            | 5           | 1-7, 21, 18, 26    | RUB           |
| Пополнение Visa\Mastercard Украина        | 6           | 1-8, 21            | UAH           |
| Пополнение Visa\Mastercard Казахстан      | 7           | 1-8, 21            | KZT           |
| Автоопределение оператора мобильной связи | 10          | 1-7, 21            | RUB           |
| WebMoney R                                | 150         | 1-7, 21            | RUB           |
| Yandex.Money                              | 153         | 1-7, 21            | RUB           |
| Qiwi кошелек                              | 156         | 1-7, 21            | RUB, EUR, USD |
| Qiwi Visa Wallet                          | 157         | 1-7, 21            | RUB           |
| РФ МТС                                    | 11          | 1-7, 21            | RUB           |
| РФ Мегафон                                | 12          | 1-7, 21            | RUB           |
| РФ Билайн                                 | 13          | 1-7, 21            | RUB           |
| РФ Tele2                                  | 14          | 1-7, 21            | RUB           |
| РФ Мотив                                  | 15          | 1-7, 21            | RUB           |
| РФ Смартс Астрахань                       | 16          | 1-7, 21            | RUB           |
| РФ Смартс Иваново                         | 17          | 1-7, 21            | RUB           |
| РФ Смартс Казань                          | 18          | 1-7, 21            | RUB           |
| РФ Смартс Пенза                           | 19          | 1-7, 21            | RUB           |
| РФ Смартс Самара,Иваново,Казань,Уфа       | 20          | 1-7, 21            | RUB           |
| РФ Смартс Чувашия                         | 21          | 1-7, 21            | RUB           |
| РФ Смартс Ярославль                       | 22          | 1-7, 21            | RUB           |
| РФ Улан-Уденская Сотовая Сеть             | 23          | 1-7, 21            | RUB           |
| РФ Yota                                   | 47          | 1-7, 21            | RUB           |
| РФ Скайлинк Волгоград                     | 48          | 1-7, 21            | RUB           |
| РФ Скайлинк Владимир                      | 49          | 1-7, 21            | RUB           |
| РФ Тинькофф Мобаил                        | 50          | 1-7, 21            | RUB           |
| Ростелеком                                | 51          | 1-7, 21            | RUB           |
| Мосэнергосбыт                             | 158         | 1-7, 21            | RUB           |
| Денежные переводы БЭСТ                    | 200         | 1-7, 10-19, 21, 22 | RUB           |
| Переводы на л\с в банки РФ          | 201         | 1-7, 20, 21, 25, 29 | RUB           |
| Переводы SEPA                       | 202         |                     | EUR           |
| Игры: Мэйл.Ру: Warface              | 10001       | 1-7, 21             | RUB           |
| Игры: Wargaming: World of Tanks     | 10002       | 1-7, 21             | RUB           |
| Игры: Wargaming: World of Warplanes | 10003       | 1-7, 21             | RUB           |
| Игры: Wargaming: World of Warships  | 10004       | 1-7, 21             | RUB           |
| Игры: Танки Онлайн                  | 10005       | 1-7, 21             | RUB           |
| Игры: Steam                         | 10006       | 1-7, 21             | RUB           |
| Игры: Nikita online                 | 10007       | 1-7, 21             | RUB           |
| Игры: Иксолла: War Thunder          | 10008       | 1-7, 21             | RUB           |
| Игры: Иксолла: Black Desert         | 10009       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: Perfect World        | 10010       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: Аллоды Онлайн        | 10011       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: Cross Fire           | 10012       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: Riot                 | 10013       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: SkyForge             | 10014       | 1-7, 21             | RUB           |
| Игры: Мэйл.Ру: Проект Армата        | 10015       | 1-7, 21             | RUB           |
       


### 10. Тестовые карты.

Выплаты с тестовой среды проводятся на реальные карты.

### FAQ



